define("wiki-album:widget/picture/pictureDialog/lib/picture_service.js",function(e,t,i){var u=e("wiki-common:widget/lib/jquery/jquery.js"),r=function(e){var t={};u.extend(t,e);var i=!1,r=!1,a=null,n=function(t){e.album.pictures=t},c=function(t,i){e.album.pictures||(e.album.pictures=[]),e.album.pictures.length>i+1&&(e.album.pictures=e.album.pictures.splice(i,0)),e.album.pictures=e.album.pictures.concat(t)};this.isLoading=function(){return i},this.isPreLoad=function(e){return"undefined"!=typeof e&&null!=e&&(r=e),r},this.request=function(s){s=s?s:{},s.num=s.num?s.num:30;var l=e.album.pictures?e.album.pictures.length:0,o=s.pn?s.pn:l,m={lemmaid:t.lemmaId,sublemmaid:t.subLemmaId,aid:t.albumId};t.picPageType+""=="1"?m.versionid=t.versionId:t.picPageType+""=="2"&&(m.commitid=t.commitId),s.pictureSign?u.extend(m,{src:s.pictureSign}):u.extend(m,{pn:o,rn:s.num?s.num:30}),i=!0,r=!!s.preLoad,a=u.ajax({url:0==t.picPageType?"/ajax/getPhotos":"/ajax/gethisphotos",type:"get",data:m,dataType:"json",error:function(){!r&&!!e.error&&e.error("网络错误"),i=!1},success:function(t){"0"!=t.errno&&t.msg&&s.error?!r&&!!e.error&&e.error(t.msg):(0>=o||s.pictureSign?(o=0,n(t.data.list)):c(t.data.list,o),l=e.album.pictures.length,t.data.list.length<s.num&&l!=e.album.total&&(e.album.total=l),!r&&!!e.success&&e.success(o,t.data.list),!!r&&!!s.preLoadSuccess&&s.preLoadSuccess(o,t.data.list)),i=!1}})},this.cancel=function(){a&&a.cancel()}};i.exports=r});
;define("wiki-album:widget/picture/pictureDialog/lib/album.js",function(e,t,i){var n=(e("wiki-common:widget/lib/jquery/jquery.js"),e("wiki-album:widget/picture/pictureDialog/lib/picture_service.js")),r=function(e){var t=e.album,i=this,r=null,u=null,s=null,c=new n({lemmaId:e.lemmaId,subLemmaId:e.subLemmaId,albumId:e.album.sign,picPageType:e.picPageType,versionId:e.versionId,commitId:e.commitId,album:e.album,error:function(e){!!s&&s(e)},success:function(e,t){e>0?!!r&&r(e,t):!!u&&u(t)}});this.getData=function(){return t},this.getPictures=function(){return t.pictures},this.getPictureLength=function(){return t.pictures?t.pictures.length:0},this.getTotal=function(){return t.total},this.getCover=function(){return{sign:t.coversrc,url:t.coverurl}},this.getSign=function(){return t.sign},this.getDescription=function(){return t.desc},this.getPictureByIndex=function(e){return 0>e?null:e<this.getPictureLength()?(t.pictures[e].index=e,t.pictures[e]):null},this.getNext=function(){return t.next},this.getPrev=function(){return t.prev},this.hasMore=function(){return i.getTotal()>i.getPictureLength()},this.loadMore=function(e){r=e.success,s=e.error,c.isLoading()?c.isPreLoad(!1):c.request({num:e.num})},this.preLoadMore=function(e){this.getPictureLength()>=this.getTotal()||c.isLoading()||c.request({preLoad:!0,preLoadSuccess:e?e.success:null})},this.preLoad=function(){c.isLoading()||this.getPictureLength()<=0&&c.request({preLoad:!0})},this.load=function(e){return this.getPictureLength()>0?void(!!e.success&&e.success(i)):(u=e.success,s=e._errorHandler,void(c.isLoading()?c.isPreLoad(!1):this.getPictureLength()<=0&&c.request()))}};i.exports=r});
;define("wiki-album:widget/picture/pictureDialog/lib/data_center.js",function(e,t,u){var n=(e("wiki-common:widget/lib/jquery/jquery.js"),e("wiki-album:widget/picture/pictureDialog/lib/album.js")),l=function(e){var t=this,u=e?e.lemmaId:null,l=e?e.subLemmaId:null,i=e?e.versionId:null,r=e?e.commitId:null,a=e?e.albums:null,o=e?e.albumId:null,m=e?e.picPageType:0,d=null,c=null,s=null,g=function(e){return new n({picPageType:m,lemmaId:u,subLemmaId:l,versionId:i,commitId:r,album:e})},b=function(e){var t=e||e+""=="0"?a[e]:null;return t?g(t):null};this.setCurrentAlbum=function(e){d=b(e),c=b(d.getPrev()),s=b(d.getNext()),t.preLoad()},this.preLoad=function(){var e=s?b(s.getNext()):null;!!d&&d.preLoad(),!!c&&c.preLoad(),!!s&&s.preLoad(),!!e&&e.preLoad()},this.getCurrentAlbum=function(){return d},this.getPrevAlbum=function(){return c},this.getNextAlbum=function(){return s},this.goNextAlbum=function(e){if(s){c=d,d=s,s=b(d.getNext());var t=!!s&&b(s.getNext());!!s&&s.preLoad(),!!t&&t.preLoad(),d.load(e)}},this.goPrevAlbum=function(e){c&&(s=d,d=c,c=b(d.getPrev()),!!c&&c.preLoad(),d.load(e))},this.getAlbums=function(){return a},this.getAlbumById=function(e){var t=a[e];return t?g(t):null},this.initialize=function(e){u=e?e.lemmaId:null,l=e?e.subLemmaId:null,a=a?a:e?e.albums:null,o=e?e.albumId:null,currentPictureSign=e?e.pictureSign:null,i=e?e.versionId:null,r=e?e.commitId:null,m=e?e.picPageType:0,a instanceof Array&&1==a.length&&(a={0:a[0]}),t.setCurrentAlbum(o)}};u.exports=l});
;define("wiki-album:widget/picture/pictureDialog/lib/image_load.js",function(i,e,t){var r=i("wiki-common:widget/lib/jquery/jquery.js"),n=function(i){var e=new Image;e=i.src;var t=function(){return r("<div class='loading-gif'></div>").css({width:"100%",height:"100%",display:"none",position:"relative",background:"url("+i.src+") no-repeat center center"})};this.loading=function(i){i.hide();var e=i.parent().find(".loading-gif");e=e.length>0?e:t().insertAfter(i),e.show()},this.load=function(i,e,r,n){var o=new Image,a=i.parent().find(".loading-gif");if(i.attr("url",e),n?(a=a.length>0?a:t().insertAfter(i),a.show()):a&&a.hide(),i.hide(),o.src=e,o.complete){if(i.attr("url")!=e)return;i.attr("src",e),i.show(),!!n&&a.remove(),!!r&&r(i,o.width,o.height)}else o.onload=function(){i.attr("url")==e&&(i.attr("src",e),i.show(),!!n&&a.remove(),r&&r(i,o.width,o.height))}}};t.exports=n});
;define("wiki-album:widget/picture/pictureDialog/lib/picture_panel.js",function(i,t,e){var c=i("wiki-common:widget/lib/jquery/jquery.js"),n=i("wiki-common:widget/component/nslog/nslog.js"),p=i("wiki-album:widget/picture/pictureDialog/lib/image_load.js"),o=function(){var i=this,t={width:null,height:null},e=null,o=null,r={container:c("#picture-dialog .picture"),picture:c("#imgPicture"),tip:c("#picture-msg-tip"),tipText:c("#picture-msg-tip .msg-tip-text"),tipClose:c("#picture-msg-tip .close")};r.container.css({"margin-top":"0px","margin-left":"0px"});var u=new p({src:"https://bkssl.bdimg.com/static/wiki-album/widget/picture/pictureDialog/resource/img/loading_40acd78.gif"});r.tipClose.click(function(){r.tip.hide()}),this.displayTip=function(i){r.tip.css({top:r.container.height()/2+50+"px",left:(r.container.width()-460)/2+"px"}),r.tipText.text("您正在浏览“"+i+"”图册"),r.tip.fadeIn(200,function(){r.tip.show(),setTimeout(function(){r.tip.fadeOut(200,function(){r.tip.hide()})},1e3)})},this.loading=function(){u.loading(r.picture)},this.resize=function(i,e){var c=i?i:r.picture[0].width,n=e?e:r.picture[0].height;t.width=(i?i:t.width)||c,t.height=(e?e:t.height)||n;var p=r.picture.parent().width(),o=r.picture.parent().height(),u=c/p,s=n/o;i=c,e=n,u>s?(i=p,e=n/u):(e=o,i=c/s),t.width<=i&&t.height<=e&&(i=t.width,e=t.height),r.picture.width(i).height(e),r.picture.css({"margin-top":(o-e)/2+"px"})},this.display=function(t){u.load(r.picture,t,function(c,p,r){return c.attr("src")!=t?void c.hide():(!!e&&clearTimeout(e),!!o&&clearTimeout(o),i.resize(p,r),n(9302),void(o=setTimeout(function(){n(9315)},300)))},!1)},this.css=function(i){r.container.css.call(r.container,i)}};e.exports=o});
;define("wiki-album:widget/picture/pictureDialog/lib/picture_tool.js",function(r,t,e){var i={};i.getRightPicture=function(r,t,e){var i=null;for(var n in r){var a=(parseInt(r[n].height),parseInt(r[n].width),parseInt(r[n].size));if(a>=e&&a>=t){i=r[n];break}}return null==i&&(i=this.getMaxPicture(r)),i},i.getMinPciture=function(r){var t=2e3;for(var e in r){var i=parseInt(e);t>=i&&(t=i)}return r[t]},i.getMaxPicture=function(r){var t=0;for(var e in r){var i=parseInt(e);i>=t&&(t=i)}return r[t]},e.exports=i});
;define("wiki-album:widget/picture/pictureDialog/lib/thumbnail.js",function(e,t,i){var n=e("wiki-common:widget/lib/jquery/jquery.js"),r=e("wiki-common:widget/component/nslog/nslog.js"),l=e("wiki-album:widget/picture/pictureDialog/lib/image_load.js"),a=e("wiki-album:widget/picture/pictureDialog/lib/picture_tool.js"),u=function(e){var t=80,i=80,u="https://bkssl.bdimg.com/static/wiki-album/widget/picture/pictureDialog/resource/img/thumbnail_loading_9560019.gif",c=this,s=e.dataCenter,o=new l({src:u}),d=!1,m={container:n("#picture-dialog .thumbnail"),selecedCover:n('<div class="seleced-cover"></div>')};n.extend(m,{prevAlbum:m.container.find(".prev-album"),nextAlbum:m.container.find(".next-album"),prevPic:m.container.find(".prev-pic"),nextPic:m.container.find(".next-pic"),picList:m.container.find(".pic-slider .pic-list"),picScroller:m.container.find(".pic-slider,.pic-scroller"),bottomBg:m.container.find(".bottom")}),m.prevAlbum.click(function(){d||(c.prevAlbum(),r(9320))}),m.nextAlbum.click(function(){d||(c.nextAlbum(),r(9319))}),m.prevPic.click(function(){d||(c.prev(),r(9306))}),m.nextPic.click(function(){d||(c.next(),r(9306))});var b={pictureChanged:null,albumChanged:null,beforeRequest:null,beforeAlbumChange:null,afterRequest:null};n.extend(b,e),m.picList.click(function(e){if(!d){var t=n(e.target);return(t=t.hasClass("pic-item")?t:t.parent().hasClass("pic-item")?t.parent():null)?(r(9305),c.slideTo(t),!1):!1}});var p=function(e,n,r){var l=n,a=r,u=l/t,c=a/i,n=n?n:t,r=r?r:i;c>1&&u>=c||u>1&&1>=c?(r=i,n=l/c):(u>1&&c>=u||c>1&&1>=u)&&(n=t,r=a/u),e.width(Math.round(n)).height(Math.round(r)),e.css({top:"0px",left:Math.round((t-n)/2)+"px"})},g=function(e){return e>=s.getCurrentAlbum().getPictureLength()&&e<s.getCurrentAlbum().getTotal()},f=function(e,t){var i=m.picList.children(),r=s.getCurrentAlbum().getPictures();e=0>e?0:e;for(var l=e;t>l&&l<i.length&&l<r.length;l++){var u=n(i[l]);if(u.attr("title",r[l].desc),!(u.find("img").length>0)){var c=a.getMinPciture(r[l].sizes);u.append(n('<img alt="'+r[l].desc+'"/>')),o.load(u.find("img"),c.url,p)}}},h=function(e){e+10>s.getCurrentAlbum().getPictureLength()&&s.getCurrentAlbum().hasMore()&&s.getCurrentAlbum().preLoadMore({success:function(){f(e-1,e+4)}})};this.slideTo=function(e){var t=parseInt(e.attr("data-index"));c.focus(e);var i=86*(t-1);m.picScroller.stop().animate({scrollTop:i+"px"},200),g(t)?(d=!0,s.getCurrentAlbum().loadMore({success:function(){f(t-1,t+4),!!b.pictureChanged&&b.pictureChanged(t),!!b.afterRequest&&b.afterRequest(),d=!1},error:function(e){alert(e),d=!1,!!b.afterRequest&&b.afterRequest()}})):(f(t-1,t+4),!!b.pictureChanged&&b.pictureChanged(t),h(t))},this.focus=function(e){m.picList.children().removeClass("selected"),e.addClass("selected").append(m.selecedCover)},this.loadAlbum=function(e){m.picList.empty(),m.picScroller.stop().scrollTop(0);for(var t=0;t<e.getTotal();t++){{t<e.getPictureLength()?e.getPictureByIndex(t):null}m.picList.append("<a class='pic-item' data-index='"+t+"'></a>")}f(0,4),c.focus(n(m.picList.children()[0])),!!b.pictureChanged&&b.pictureChanged(0);var i=s.getPrevAlbum();i?(m.prevAlbum.show(),m.prevAlbum.attr("data-album",i.getSign())):(m.prevAlbum.hide(),m.prevAlbum.removeAttr("data-album"));var r=s.getNextAlbum();r?(m.nextAlbum.show(),m.bottomBg.show(),m.nextAlbum.attr("data-album",r.getSign()),o.load(m.nextAlbum.find("img"),r.getCover().url,p)):(m.nextAlbum.hide(),m.bottomBg.hide(),m.nextAlbum.removeAttr("data-album")),this.adaptPosition()},this.nextAlbum=function(){if(m.nextAlbum.attr("data-album")){var e=m.nextAlbum.attr("data-album");!!b.beforeRequest&&b.beforeRequest(),!!b.beforeAlbumChange&&b.beforeAlbumChange(e),s.goNextAlbum({success:function(){r(9316),c.loadAlbum(s.getCurrentAlbum()),!!b.afterRequest&&b.afterRequest()}})}},this.prevAlbum=function(){if(m.prevAlbum.attr("data-album")){var e=m.prevAlbum.attr("data-album");!!b.beforeRequest&&b.beforeRequest(),!!b.beforeAlbumChange&&b.beforeAlbumChange(e),s.goPrevAlbum({success:function(){r(9316),c.loadAlbum(s.getCurrentAlbum()),!!b.afterRequest&&b.afterRequest()}})}},this.next=function(){var e=m.picList.find(".pic-item.selected");e.length>0&&(r(9304),e.next().length>0?c.slideTo(e.next()):s.getNextAlbum()?c.nextAlbum():c.slideTo(n(m.picList.children()[0])))},this.prev=function(){var e=m.picList.find(".pic-item.selected");e.length>0&&(r(9303),e.prev().length>0?c.slideTo(e.prev()):s.getPrevAlbum()?c.prevAlbum():c.slideTo(n(m.picList.children()[m.picList.children().length-1])))},this.css=function(e){m.container.css.call(m.container,e)},this.adaptPosition=function(){},this.disalbeAction=function(){d=!0,m.nextPic.addClass("disable"),m.prevAlbum.addClass("disable"),m.prevPic.addClass("disable")},this.enableAction=function(){d=!1,m.nextPic.removeClass("disable"),m.prevAlbum.removeClass("disable"),m.prevPic.removeClass("disable")},c.slideTo(m.picList.find(".selected"))};i.exports=u});
;define("wiki-album:widget/picture/pictureDialog/pictureDialog.js",function(i,t,e){var n=i("wiki-common:widget/lib/jquery/jquery.js"),o=(i("wiki-common:widget/util/cookie.js"),i("wiki-common:widget/util/browser.js")),r=i("wiki-common:widget/component/urls/getLemmaUrl.js"),u=i("wiki-common:widget/component/nslog/nslog.js"),c=(i("wiki-album:widget/picture/pictureDialog/lib/image_load.js"),i("wiki-album:widget/picture/pictureDialog/lib/data_center.js")),a=i("wiki-album:widget/picture/pictureDialog/lib/thumbnail.js"),l=i("wiki-album:widget/picture/pictureDialog/lib/picture_panel.js"),p=i("wiki-album:widget/picture/pictureDialog/lib/picture_tool.js"),s=function(i,t,e,n){return r(n,e,i,t)},m=function(i,t){return"/pic/"+encodeURIComponent(t)+"/"+i},d=function(i){var t={onClose:null,onOrigin:null},e={closeButton:n(".tool-button.close"),returnButton:n(".return-back"),albumName:n("#picture-dialog .breadcrumb .album-name"),albumDescription:n("#picture-dialog .breadcrumb .album-desc"),number:n("#picture-dialog .description .number"),description:n("#picture-dialog .description"),pictureDescription:n("#picture-dialog .description .text"),returnButton:n("#picture-dialog .return-back")};n.extend(t,i),e.returnButton.click(function(){u(10300101)}),e.albumName.click(function(){u(9310)}),this.setBreadCrumb=function(i){e.albumDescription.text(i)},this.setAlbumName=function(i,t,n){e.albumName.attr("href",t).text(i),n&&e.albumName.click(n)},this.setAlbumDescription=function(i){e.albumDescription.text(i)},this.setBackLink=function(i,t){var n=s(i,t);e.returnButton.attr("href",n+"fr=picture")},this.adaptPosition=function(){}},f=function(i){var t={onClose:null,onOrigin:null},e={wrap:n(".picture-footer .footer-wrap"),infoButton:n(".picture-footer .info"),originButton:n(".picture-footer .origin"),number:n(".picture-footer .description .number"),description:n(".picture-footer .description"),pictureDescription:n(".picture-footer .description .text"),infoPanel:n(".picture-footer .info-panel"),sizeInfo:n(".picture-footer .info-panel .size"),albumInfo:n(".picture-footer .info-panel .album-text"),lemmaName:n(".picture-footer .info-panel .lemma-name"),albumName:n(".picture-footer .info-panel .album-name")};n.extend(t,i),e.wrap.css({"margin-left":"0px"}),e.originButton.click(t.onOrigin),e.infoButton.hover(function(){e.infoPanel.stop().fadeIn()},function(){e.infoPanel.stop().fadeOut()}),e.infoPanel.hover(function(){e.infoPanel.stop().show()},function(){e.infoPanel.stop().fadeOut()}),e.albumName.click(function(){u(10300102)}),e.lemmaName.click(function(){u(10300103)}),this.setNumber=function(i,t){return i&&t?void e.number.html('<span style="color:#b9bbbf">'+i+'</span>/<span style="color:#427cb8">'+t+"</span>"):void e.number.html("")},this.setPictureDescription=function(i){e.pictureDescription.text(i)},this.setOriginUrl=function(i){e.originButton.attr("href",i)},this.adaptPosition=function(i,t){e.wrap.css({width:i,left:t})},this.setSizeInfo=function(i,t){e.sizeInfo.text(i+" X "+t)},this.setAlbumInfo=function(i,t,n,o){e.lemmaName.text(i).attr("href",n),e.albumName.text(t).attr("href",o)}},g=function(){var i=this,t={},e=new c,r=new l(e),g=!1,h=null,b=null,w={container:n("#picture-dialog"),pictureWrap:n("#picture-dialog .picture-wrap"),pictureContainer:n("#picture")},v=function(){b=new a({pictureChanged:function(i){var n=e.getCurrentAlbum().getPictures(),o=n[i];if(o){var u=p.getRightPicture(o.sizes,I.pic_Width,I.pic_Height),c=p.getMaxPicture(o.sizes);r.display(u.url),D.setOriginUrl(c.url),D.setPictureDescription(o.desc),D.setSizeInfo(c.width,c.height),!!h&&h(e.getCurrentAlbum().getSign(),o.src)}_.setAlbumDescription(e.getCurrentAlbum().getDescription()),D.setNumber(i+1,e.getCurrentAlbum().getTotal());var a=s(t.lemmaId,t.subLemmaId,t.lemmaTitle,t.newLemmaId),l=m(t.newLemmaId,t.lemmaTitle);"1"==t.picPageType?(a="/history/"+encodeURIComponent(t.lemmaTitle)+t.versionId,l="javascript:;"):"2"==t.picPageType&&(a="/archive/"+encodeURIComponent(t.lemmaTitle)+t.commitId,l="javascript:;"),D.setAlbumInfo(t.lemmaName+"词条",e.getCurrentAlbum().getDescription(),a,l)},beforeRequest:function(){b.disalbeAction(),i.disalbeAction(),_.setAlbumDescription(""),D.setPictureDescription(""),D.setNumber(0,0),r.loading()},afterRequest:function(){b.enableAction(),i.enableAction()},beforeAlbumChange:function(i){var t=e.getAlbumById(i);t&&(r.loading(),r.displayTip(t.getDescription()))},dataCenter:e})},_=new d({onClose:function(){i.hide()},onOrigin:function(){u(9307),u(9308),u(9309)}}),D=new f({onOrigin:function(){u(9307),u(9308),u(9309)}}),C=function(i){var t=w.pictureContainer.offset(),e=w.pictureContainer.height(),n=w.pictureContainer.width(),o=i.pageX-t.left,r=i.pageY-t.top;return 0>o||o>n||0>r||r>e?"out":.3>=r/e?"up":"down"};w.pictureContainer.bind("mousemove",function(i){var t=C(i);"up"==t?w.pictureContainer.removeClass("picture-mouse-down").addClass("picture-mouse-up"):"down"==t&&w.pictureContainer.removeClass("picture-mouse-up").addClass("picture-mouse-down")}).bind("click",function(i){if(!g){var t=C(i);"up"==t?b.prev():"down"==t&&b.next()}}),w.pictureWrap.bind("mousewheel",function(i,t){if(!g){var e=0;e=-t,u(9311),e>0?b.next():b.prev()}});var I={HEADER_HEIGHT:42,MARGIN_TOP:62,MARGIN_BOTTOM:40,THU_WIDTH:80,thu_Height:544,pic_Height:645,pic_Width:968,pic_MarginRight:0,thu_MarginTop:102,thu_Height:600,thu_MarginLeft:48,thu_MarginRight:110},k=function(){n("html").removeClass("picture-dialog-display")},T=function(){n("html").addClass("picture-dialog-display"),n(document.body).scroll(function(i){return i.preventDefault(),!1})},A=function(){var i=n(window).width(),t=n(window).height(),e=i-I.THU_WIDTH;I.pic_Width=.75*e,I.pic_Height=t-I.MARGIN_TOP-I.MARGIN_BOTTOM,e-=I.pic_Width;var o=e/2;I.thu_MarginRight=.7*o,I.thu_MarginLeft=o-I.thu_MarginRight,r.css({height:I.pic_Height+"px"}),b.adaptPosition(),_.adaptPosition(I.THU_WIDTH+I.thu_MarginLeft+I.thu_MarginRight,I.pic_Width),D.adaptPosition(I.pic_Width,i-I.pic_Width-(I.THU_WIDTH+I.thu_MarginLeft+I.thu_MarginRight))};n(window).resize(function(){A(),r.resize()});var P=function(i){if(!g){var t=i.which;40==t?(b.next(),u(9313),i.preventDefault()):38==t&&(b.prev(),u(9312),i.preventDefault())}};this.show=function(c){n.extend(t,c),h=c.pictureChanged,e.initialize(c),v(),A(),r.resize();var a=m(c.newLemmaId,c.lemmaTitle);"0"!=c.picPageType&&(a="javascript:;"),_.setAlbumName(c.lemmaName+"图册",a,function(t){return c.crumbClick?c.crumbClick(t,i):void 0}),T(),o.ie()&&"6"==o.ie()&&w.container.css({top:n(window).scrollTop()+"px"}),n(document).bind("keydown",P),u(9301)},this.hide=function(){k(),w.container.hide(),n(document).unbind("keydown",P),u(9321)},this.disalbeAction=function(){g=!0},this.enableAction=function(){g=!1}};g.getInstance=function(){return window.pictureDialog||(window.pictureDialog=new g),window.pictureDialog},e.exports=g});